___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "CLIENT",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Custom Event Parser",
  "categories": ["TAG_MANAGEMENT", "UTILITY"],
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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\u003d"
  },
  "description": "This vendor agnostic client handles any GET or POST request. It extracts information from query string, headers, IP, body, and cookies and returns the data to the server container as an event object.",
  "containerContexts": [
    "SERVER"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "requestPath",
    "displayName": "Request Path",
    "simpleValueType": true,
    "help": "The path of the requests which should be handled by this client (has to start with /).",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "defaultValue": "/path"
  },
  {
    "type": "TEXT",
    "name": "cookieName",
    "displayName": "Cookie Name",
    "simpleValueType": true,
    "help": "Optional: The name of the cookie that should be added to the event data object (has to be on the same domain as the server container)."
  }
]


___SANDBOXED_JS_FOR_SERVER___

//Necessary APIs
const claimRequest = require('claimRequest');
const getRequestPath = require('getRequestPath');
const returnResponse = require('returnResponse');
const runContainer = require('runContainer');
const setPixelResponse = require('setPixelResponse');
const getCookie = require('getCookieValues');
const getRequestQueryParameters = require('getRequestQueryParameters');
const getRemoteAddress = require('getRemoteAddress');
const getRequestHeader = require('getRequestHeader');
const getRequestMethod = require('getRequestMethod');
const getRequestBody = require('getRequestBody');
const JSON = require('JSON');
const getTimestampMillis = require('getTimestampMillis');

//Get the request path for claiming the request
const requestPath = getRequestPath();
//Get the query string parameters and store them in an object
const queryParameters = getRequestQueryParameters();
//Get the IP and store it in a variable
const ip = getRemoteAddress();
//Get the UA and store it in a variable
const ua = getRequestHeader('user-agent');
//Get the referrer and store it in a variable
const referer = getRequestHeader('referer');
//Get the timestamp and store it in a variable
const timestamp = getTimestampMillis();
//Get request body, store it in a variable, parse as JSON object
//Note that there might be some further parsing or structuring needed depending on the format of the request body
const requestBody = getRequestBody();
const requestBodyObject = JSON.parse(requestBody);
//Get the cookie value and store it in a variable
if (data.cookieName) {
var cookieName = data.cookieName;
var cookieValue = getCookie(cookieName);
}

//Claim the request according to the Request Path input field
if (requestPath.indexOf(data.requestPath) > -1) { 
  
claimRequest();
  
setPixelResponse();

//Create event data object
const event = {};
//Add querystring parameters to event data object
for (var attrname in queryParameters) { event[attrname] = queryParameters[attrname]; }
//Add POST request body object to event data object
if (getRequestMethod() === 'POST') {
for (var attrname in requestBodyObject) { event[attrname] = requestBodyObject[attrname]; }
}
//Add further data to event data object
event.ip_override = ip;
event.user_agent = ua;
event.page_location = referer;
event.timestamp = timestamp;
if (data.cookieName) {
event[cookieName] = cookieValue;
}
  
runContainer(event, () => returnResponse());
  
}


___SERVER_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "read_request",
        "versionId": "1"
      },
      "param": [
        {
          "key": "requestAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "headerAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "queryParameterAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "return_response",
        "versionId": "1"
      },
      "param": []
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_response",
        "versionId": "1"
      },
      "param": [
        {
          "key": "writeResponseAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "writeHeaderAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "run_container",
        "versionId": "1"
      },
      "param": []
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "cookieAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 9/9/2021, 12:19:56 PM


